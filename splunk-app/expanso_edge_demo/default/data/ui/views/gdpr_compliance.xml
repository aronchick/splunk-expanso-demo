<dashboard version="1.1" theme="dark">
  <label>GDPR Compliance</label>
  <description>Geographic data routing and GDPR compliance monitoring</description>

  <row>
    <panel>
      <title>EU Storage Events</title>
      <single>
        <search>
          <query>index=eu_main | stats count</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="underLabel">GDPR Compliant</option>
      </single>
    </panel>
    <panel>
      <title>US Storage Events</title>
      <single>
        <search>
          <query>index=us_main | stats count</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="underLabel">Standard Storage</option>
      </single>
    </panel>
    <panel>
      <title>EU PII Events</title>
      <single>
        <search>
          <query>index=eu_main has_pii=true | stats count</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="underLabel">Contains PII - Retained in EU</option>
      </single>
    </panel>
  </row>

  <row>
    <panel>
      <title>Data Distribution by Region</title>
      <chart>
        <search>
          <query>index=us_main OR index=eu_main | eval region=if(index="eu_main","EU (GDPR)","US (Standard)") | stats count by region</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">pie</option>
      </chart>
    </panel>
    <panel>
      <title>EU vs US Traffic Over Time</title>
      <chart>
        <search>
          <query>index=us_main OR index=eu_main | eval region=if(index="eu_main","EU","US") | timechart span=1h count by region</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.chart.stackMode">stacked</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Compliance Status by Source Node</title>
      <table>
        <search>
          <query>index=us_main OR index=eu_main | eval compliance=if(index="eu_main","GDPR Compliant","Standard") | stats count by host, compliance | sort - count</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">cell</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>GDPR Routing Summary</title>
      <html>
        <div style="padding: 20px; background: #1a1a1a; border-radius: 8px;">
          <h3 style="color: #65a637;">Expanso Edge GDPR Compliance</h3>
          <p style="color: #ccc;">
            Expanso Edge pipelines automatically route data based on geographic origin and PII content:
          </p>
          <ul style="color: #999;">
            <li><strong>EU Data with PII:</strong> Retained in EU storage (eu_main index)</li>
            <li><strong>EU Data without PII:</strong> Can be routed to US for cost optimization</li>
            <li><strong>US/APAC Data:</strong> Routed to US storage (us_main index)</li>
          </ul>
          <p style="color: #999; font-size: 0.9em; margin-top: 15px;">
            Compliance rules are enforced at the edge before data leaves the source region.
          </p>
        </div>
      </html>
    </panel>
  </row>
</dashboard>
