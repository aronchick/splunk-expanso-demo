<dashboard version="1.1" theme="dark">
  <label>Expanso Edge Overview</label>
  <description>Real-time overview of Expanso Edge data pipelines</description>

  <row>
    <panel>
      <title>Total Events (Last Hour)</title>
      <single>
        <search>
          <query>index=web OR index=security OR index=os OR index=metrics | stats count</query>
          <earliest>-1h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Active Nodes</title>
      <single>
        <search>
          <query>index=web OR index=security OR index=os | stats dc(host) as nodes</query>
          <earliest>-15m@m</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Error Rate</title>
      <single>
        <search>
          <query>index=security sourcetype=apache_error | stats count as errors | appendcols [search index=web | stats count as total] | eval rate=round((errors/total)*100,2) | table rate</query>
          <earliest>-1h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="unit">%</option>
        <option name="rangeColors">["0x65a637","0xf8be34","0xdc4e41"]</option>
        <option name="rangeValues">[1,5]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Indexes Active</title>
      <single>
        <search>
          <query>index=web OR index=security OR index=os OR index=metrics OR index=us_main OR index=eu_main | stats dc(index) as indexes</query>
          <earliest>-1h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
      </single>
    </panel>
  </row>

  <row>
    <panel>
      <title>Events Over Time</title>
      <chart>
        <search>
          <query>index=web OR index=security OR index=os | timechart span=5m count by index</query>
          <earliest>-4h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.legend.placement">bottom</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Events by Index</title>
      <chart>
        <search>
          <query>index=web OR index=security OR index=os OR index=metrics | stats count by index | sort - count</query>
          <earliest>-1h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">pie</option>
      </chart>
    </panel>
    <panel>
      <title>Events by Region</title>
      <chart>
        <search>
          <query>index=us_main OR index=eu_main | eval region=if(index="eu_main","EU","US") | stats count by region</query>
          <earliest>-1h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">pie</option>
      </chart>
    </panel>
    <panel>
      <title>Top Hosts</title>
      <table>
        <search>
          <query>index=web OR index=security OR index=os | stats count by host | sort - count | head 10</query>
          <earliest>-1h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">cell</option>
      </table>
    </panel>
  </row>
</dashboard>
