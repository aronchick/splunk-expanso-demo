<dashboard version="1.1" theme="dark">
  <label>Web Traffic</label>
  <description>Apache access logs from Expanso Edge nodes</description>

  <row>
    <panel>
      <title>Requests/min</title>
      <single>
        <search>
          <query>index=web sourcetype=access_combined | stats count | eval rpm=round(count/60,0) | table rpm</query>
          <earliest>-1h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
      </single>
    </panel>
    <panel>
      <title>Unique IPs</title>
      <single>
        <search>
          <query>index=web sourcetype=access_combined | rex field=_raw "^(?&lt;clientip&gt;\d+\.\d+\.\d+\.\d+)" | stats dc(clientip)</query>
          <earliest>-1h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
      </single>
    </panel>
    <panel>
      <title>4xx Errors</title>
      <single>
        <search>
          <query>index=web sourcetype=access_combined | rex field=_raw "HTTP/1\.[01]\" (?&lt;status&gt;4\d\d)" | stats count</query>
          <earliest>-1h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0x65a637","0xf8be34","0xdc4e41"]</option>
        <option name="rangeValues">[10,50]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>5xx Errors</title>
      <single>
        <search>
          <query>index=web sourcetype=access_combined | rex field=_raw "HTTP/1\.[01]\" (?&lt;status&gt;5\d\d)" | stats count</query>
          <earliest>-1h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0x65a637","0xf8be34","0xdc4e41"]</option>
        <option name="rangeValues">[5,20]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>

  <row>
    <panel>
      <title>Request Volume Over Time</title>
      <chart>
        <search>
          <query>index=web sourcetype=access_combined | timechart span=1m count</query>
          <earliest>-1h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.legend.placement">none</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>HTTP Status Codes</title>
      <chart>
        <search>
          <query>index=web sourcetype=access_combined | rex field=_raw "HTTP/1\.[01]\" (?&lt;status&gt;\d+)" | stats count by status | sort - count</query>
          <earliest>-1h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">bar</option>
      </chart>
    </panel>
    <panel>
      <title>Top URLs</title>
      <table>
        <search>
          <query>index=web sourcetype=access_combined | rex field=_raw "\"(?:GET|POST|PUT|DELETE) (?&lt;uri&gt;[^\s]+)" | stats count by uri | sort - count | head 15</query>
          <earliest>-1h@h</earliest>
          <latest>now</latest>
        </search>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>Recent Access Logs</title>
      <event>
        <search>
          <query>index=web sourcetype=access_combined | head 100</query>
          <earliest>-15m@m</earliest>
          <latest>now</latest>
        </search>
        <option name="list.drilldown">full</option>
      </event>
    </panel>
  </row>
</dashboard>
