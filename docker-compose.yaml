---
# Expanso Edge Demo - Simple local setup
#
# Usage:
#   docker compose up -d --scale edge=6
#   tail -f logs/web.log
#   docker compose down

services:
  hec:
    image: python:3.11-slim
    ports:
      - "127.0.0.1:8088:8088"
    volumes:
      - ./docker/hec-receiver.py:/app/hec-receiver.py:ro
      - ./logs:/app/logs
    environment:
      - LOG_DIR=/app/logs
    working_dir: /app
    command: python /app/hec-receiver.py

  edge:
    image: ghcr.io/expanso-io/expanso-edge:latest
    volumes:
      - ./pipelines/fleet-universal.yaml:/etc/expanso/pipeline.yaml:ro
    environment:
      - SPLUNK_HEC_US=http://hec:8088
      - SPLUNK_HEC_EU=http://hec:8088
      - SPLUNK_HEC_TOKEN=${SPLUNK_HEC_TOKEN:-demo}
      - EMIT_INTERVAL=${EMIT_INTERVAL:-1s}
    command: ["run", "/etc/expanso/pipeline.yaml"]
    depends_on:
      - hec
